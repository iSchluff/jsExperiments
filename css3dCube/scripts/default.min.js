(function(){window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame})();var FILTER=0.6,FILTER2=0.03,TRESHOLD=0.001,prevClass="show-front",sourceMat,lastPos=[0,0],xDiff=0,yDiff=0,xRot=0,yRot=0,xSpeed=0,ySpeed=0,mouseDown=!1,animating=!1,inverted=!1;
function init(){$("#cube").mousedown(function(a){mouseDown=!0;lastPos[0]=a.pageX;lastPos[1]=a.pageY;yDiff=xDiff=ySpeed=xSpeed=0;console.log(nextnumber(180*xRot/Math.PI)+" "+nextnumber(180*yRot/Math.PI));$("#main").mousemove(function(a){xDiff=3*(lastPos[0]-a.pageX);yDiff=3*(lastPos[1]-a.pageY);xSpeed=xDiff*(1-FILTER)+xSpeed*FILTER;ySpeed=yDiff*(1-FILTER)+ySpeed*FILTER;lastPos[0]=a.pageX;lastPos[1]=a.pageY});$("#main").mouseup(function(){mouseDown=!1;$("#main").unbind("mousemove");$("#main").unbind("mouseup")});
animating||(requestAnimationFrame(onEnterFrame),animating=!0)});sourceMat=Matrix.create([[1,0,0],[0,1,0],[0,0,1]])}
function onEnterFrame(a){mouseDown||0!=xSpeed||0!=ySpeed?requestAnimationFrame(onEnterFrame):(animating=!1,console.log("stopped Animation"));inverted=180==nextnumber(180*yRot/Math.PI)?!0:!1;mouseDown?(xRot*=180/Math.PI,yRot*=180/Math.PI,xRot=inverted?xRot-xDiff/2.5:xRot+xDiff/2.5,yRot+=yDiff/2.5,xRot+=360,xRot%=360,yRot+=360,yRot%=360,xRot*=Math.PI/180,yRot*=Math.PI/180,yDiff=xDiff=0):(xRot*=180/Math.PI,yRot*=180/Math.PI,inverted?(xSpeed=xSpeed*(1-FILTER2)+(-nextnumber(xRot)+xRot)*FILTER2,xRot-=xSpeed/
2.5):(xSpeed=xSpeed*(1-FILTER2)+(nextnumber(xRot)-xRot)*FILTER2,xRot+=xSpeed/2.5),ySpeed=ySpeed*(1-FILTER2)+(nextnumber(yRot)-yRot)*FILTER2,yRot+=ySpeed/2.5,ySpeed*=0.95,xSpeed*=0.95,xSpeed<TRESHOLD&&xSpeed>-TRESHOLD&&(xSpeed=0),ySpeed<TRESHOLD&&ySpeed>-TRESHOLD&&(ySpeed=0),xRot+=360,xRot%=360,yRot+=360,yRot%=360,xRot*=Math.PI/180,yRot*=Math.PI/180);a=sourceMat.multiply(Matrix.RotationY(xRot).multiply(Matrix.RotationX(-yRot)));$("#cube").css("-webkit-transform",mat3ToString(a));$("#cube").css("-ms-transform",
mat3ToString(a));$("#cube").css("transform",mat3ToString(a))}function checkRange(a){}function mat3ToString(a){l=animating?10:0;s="matrix3d(";s+=a.e(1,1).toFixed(l)+","+a.e(1,2).toFixed(l)+","+a.e(1,3).toFixed(l)+",0,";s+=a.e(2,1).toFixed(l)+","+a.e(2,2).toFixed(l)+","+a.e(2,3).toFixed(l)+",0,";s+=a.e(3,1).toFixed(l)+","+a.e(3,2).toFixed(l)+","+a.e(3,3).toFixed(l)+",0,";return s+="0,0,-150,1)"}
function nextnumber(a){for(var d=[0,90,180,270,360],e=360,b,f,c=0;5>c;c++)b=d[c],b=a-b,Math.abs(b)<e&&(e=b,f=c);return d[f]};
